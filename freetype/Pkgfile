# Description:	TrueType font rendering library
# URL:		https://www.freetype.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	brotli libpng

name=freetype
version=2.11.0
release=1
source=(https://download.savannah.gnu.org/releases/${name}/${name}-${version}.tar.xz \
	0001-Enable-table-validation-modules.patch \
	0002-Enable-subpixel-rendering.patch \
	0003-Enable-infinality-subpixel-hinting.patch \
	0004-Enable-long-PCF-family-names.patch \
	0006-Return_FT_Err_Ok_while_trying_to_render_bitmap.patch \
	0007-Restore_quiet_no-op_rendering_of_bitmap_glyphs.patch \
	0008-sfnt-Add-API-for-retrieving-a-COLR-v1-ClipBox-table.patch \
	0009-src-sfnt-ttcolr.c-tt_face_get_color_glyph_clipbox-Mi.patch \
	0010-sfnt-Add-missing-blend-mode-plus-to-COLR-v1.patch \
	freetype2.sh)

build() {
cd ${name}-${version}

	patch -p1 -i $SRC/0001-Enable-table-validation-modules.patch
	patch -p1 -i $SRC/0002-Enable-subpixel-rendering.patch
	patch -p1 -i $SRC/0003-Enable-infinality-subpixel-hinting.patch
	patch -p1 -i $SRC/0004-Enable-long-PCF-family-names.patch
	patch -p1 -i $SRC/0006-Return_FT_Err_Ok_while_trying_to_render_bitmap.patch
	patch -p1 -i $SRC/0007-Restore_quiet_no-op_rendering_of_bitmap_glyphs.patch
	patch -p1 -i $SRC/0008-sfnt-Add-API-for-retrieving-a-COLR-v1-ClipBox-table.patch
	patch -p1 -i $SRC/0009-src-sfnt-ttcolr.c-tt_face_get_color_glyph_clipbox-Mi.patch
	patch -p1 -i $SRC/0010-sfnt-Add-missing-blend-mode-plus-to-COLR-v1.patch

	build-meson \
		-Dbrotli=enabled \
		-Dbzip2=enabled \
		-Dmmap=enabled \
		-Dpng=enabled \
		-Dzlib=enabled \
		-Dharfbuzz=disabled \
		-Ddefault_library=shared \
		. build

	meson compile ${JOBS:+-j ${JOBS}} -v -C build

	DESTDIR=$PKG meson install --no-rebuild -C build

	install -Dt $PKG/etc/profile.d -m 0644 $SRC/freetype2.sh
}
