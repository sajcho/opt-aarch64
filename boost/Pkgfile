# Description:	Free peer-reviewed portable C++ source libraries.
# URL:		https://www.boost.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	icu python3

name=boost
version=1.77.0
_pkgversion=1_77_0
release=1
source=(https://boostorg.jfrog.io/artifactory/main/release/${version}/source/${name}_${_pkgversion//./_}.tar.bz2 \
	b2-cxxflags-release.patch)

build() {
	cd ${name}_${_pkgversion//./_}

	# build b2 with default CXXFLAGS 'SAUX Aarch64' variable
	# - not required
	#patch -p1 -i $SRC/b2-cxxflags-release.patch

	./bootstrap.sh \
		--prefix=$PKG/usr \
		--with-toolset=gcc \
		--with-icu \
		--with-python=python3

	./b2 -q stage \
		architecture=arm \
		variant=release \
		debug-symbols=off \
		threading=multi \
		runtime-link=shared \
		link=shared \
		toolset=gcc \
		python=3.10 \
		cflags="$CFLAGS" \
		cxxflags="$CXXFLAGS" \
		--without-graph_parallel \
		--without-mpi \
		--layout=system \
		${JOBS:+-j ${JOBS}}

	./b2 -q install \
		architecture=arm \
		variant=release \
		debug-symbols=off \
		threading=multi \
		runtime-link=shared \
		link=shared \
		toolset=gcc \
		python=3.10 \
		cflags="$CFLAGS" \
		cxxflags="$CXXFLAGS" \
		--without-graph_parallel \
		--without-mpi \
		--layout=system \
		${JOBS:+-j ${JOBS}}


	install -m 0755 -D b2 $PKG/usr/bin/b2
	ln -s b2 $PKG/usr/bin/bjam
}
