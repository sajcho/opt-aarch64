# Description:	Free peer-reviewed portable C++ source libraries.
# URL:		https://www.boost.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	icu python3

name=boost
version=1.77.0
_pkgversion=1_77_0
release=0
source=(https://boostorg.jfrog.io/artifactory/main/release/${version}/source/${name}_${_pkgversion//./_}.tar.bz2)

build() {
	cd ${name}_${_pkgversion//./_}

	./bootstrap.sh \
		--prefix=$PKG/usr \
		--with-toolset=gcc \
		--with-icu \
		--with-python=python3

	./b2 stage \
		architecture=arm \
		variant=release \
		debug-symbols=off \
		threading=multi \
		runtime-link=shared \
		link=shared,static \
		toolset=gcc \
		python=3.9 \
		cflags="$CFLAGS" \
		cxxflags="$CXXFLAGS -Wno-deprecated-declarations -Wno-sign-compare" \
		--without-graph_parallel \
		--without-mpi \
		--layout=system \
		${JOBS:+-j ${JOBS}}

	./b2 install \
		architecture=arm \
		variant=release \
		debug-symbols=off \
		threading=multi \
		runtime-link=shared \
		link=shared,static \
		toolset=gcc \
		python=3.9 \
		cflags="$CFLAGS" \
		cxxflags="$CXXFLAGS -Wno-deprecated-declarations -Wno-sign-compare" \
		--without-graph_parallel \
		--without-mpi \
		--layout=system \
		${JOBS:+-j ${JOBS}}


	install -m 0755 -D b2 $PKG/usr/bin/b2
	ln -s b2 $PKG/usr/bin/bjam
}
