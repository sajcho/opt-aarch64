# Description:	A vector graphics library
# URL:		https://www.cairographics.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	fontconfig libxext libxrender pixman xcb-util glib

name=cairo
version=1.17.4
release=2
source=(https://cairographics.org/snapshots/${name}-${version}.tar.xz \
	fix-library-versioning.diff \
	fix-mask-usage-in-image-compositor.patch \
	fix-pdf-fonts.patch \
	xlib-xcb.diff)

build() {
	cd ${name}-${version}

	patch -p1 -i $SRC/fix-library-versioning.diff
	patch -p1 -i $SRC/fix-mask-usage-in-image-compositor.patch
	patch -p1 -i $SRC/fix-pdf-fonts.patch
	patch -p1 -i $SRC/xlib-xcb.diff

	prt-get isinst wayland-protocols mesa && PKGMK_CAIRO+=' -Dgl-backend=glesv3 -Dglesv3=enabled'

	build-meson $PKGMK_CAIRO \
		-Dtee=enabled \
		-Dspectre=disabled \
		-Dtests=disabled \
		. build

	meson compile ${JOBS:+-j ${JOBS}} -v -C build

	DESTDIR=$PKG meson install --no-rebuild -C build

	chmod +x $PKG/usr/bin/cairo-trace
}
