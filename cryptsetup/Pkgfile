# Description:	Userspace setup tool for transparent encryption of block devices using the Linux 2.6 cryptoapi
# URL:		https://gitlab.com/cryptsetup/cryptsetup
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	argon2 json-c lvm2 openssl popt util-linux

name=cryptsetup
version=2.4.2 # Note: remove automake/autoconf when upgrading to 2.5.0
release=1
source=(https://www.kernel.org/pub/linux/utils/${name}/v${version%.*}/${name}-${version}.tar.gz \
	flush-stdout.patch)

build() {
	cd ${name}-${version}

	patch -p1 -i $SRC/flush-stdout.patch

	./configure \
		--prefix=/usr \
		--sbindir=/sbin \
		--enable-libargon2 \
		--disable-static \
		--disable-external-tokens \
		--disable-ssh-token \
		--with-crypto_backend=openssl

	make V=1

	make DESTDIR=$PKG install

	rm -r $PKG/usr/share/locale

	find $PKG -type f -name '*.la' -delete
}
