# Description:	A library for bits of crypto UI and parsing
# URL:		https://wiki.gnome.org/Projects/CryptoGlue
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	glib gobject-introspection gtk3 libgcrypt libxslt meson p11-kit vala

name=gcr
version=3.41.0
release=1
source=(https://download.gnome.org/sources/${name}/${version%.*}/${name}-${version}.tar.xz)

build() {
	cd ${name}-${version}

	CFLAGS+=" -Wno-deprecated-declarations -Wno-incompatible-pointer-types"

	sed -i 's|"/desktop|"/org|' schema/*.xml
	sed -e '208 s/@BASENAME@/gcr-viewer.desktop/' \
		-e '231 s/@BASENAME@/gcr-prompter.desktop/' \
		-i ui/meson.build

	build-meson \
		-Dsystemd=disabled \
		-Dgtk_doc=false \
		. build

	meson compile ${JOBS:+-j ${JOBS}} -v -C build

	DESTDIR=$PKG meson install --no-rebuild -C build

	# clean up languages
	find $PKG/usr/share -type f -name '*.desktop' \
		-exec sed -r -e '/\[.+\]=/d' -e '/\#/d' -i {} \;

	rm -r $PKG/usr/share/locale
}
