# Description:	A multicast/unicast DNS-SD framework
# URL:		http://www.avahi.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	dbus gobject-introspection intltool libdaemon libevent

name=avahi
version=0.8
release=0
source=(https://github.com/lathiat/${name}/releases/download/v$version/${name}-${version}.tar.gz \
	avahi-daemon.run)

build() {
	cd ${name}-${version}

	autoreconf -fiv

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--enable-compat-libdns_sd \
		--enable-compat-howl \
		--disable-autoipd \
		--disable-qt3 \
		--disable-qt4 \
		--disable-qt5 \
		--disable-gtk \
		--disable-gtk3 \
		--disable-mono \
		--disable-mono-doc \
		--disable-xmltoman \
		--disable-doxygen-doc \
		--disable-pygobject \
		--disable-python \
		--disable-python-dbus \
		--disable-nls \
		--with-systemdsystemunitdir=no \
		--with-distro=none

	make
	make DESTDIR=$PKG install

	install -d -o avahi -g avahi $PKG/var/run/avahi-daemon

	ln -s avahi-compat-howl.pc $PKG/usr/lib/pkgconfig/howl.pc
	ln -s avahi-compat-libdns_sd.pc $PKG/usr/lib/pkgconfig/libdns_sd.pc
	ln -s avahi-compat-libdns_sd/dns_sd.h $PKG/usr/include/

	# avahi runit service
	install -d $PKG/etc/sv/avahi-daemon
	install -m 0755 $SRC/avahi-daemon.run $PKG/etc/sv/avahi-daemon/run
	ln -s /run/runit/supervise.avahi-daemon $PKG/etc/sv/avahi-daemon/supervise

	rm -r $PKG/run
}
